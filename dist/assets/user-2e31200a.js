import{r as a,h as e,M as P,n as I,T as i,o as L,B as D,m as M,P as m,S as q,I as k,t as Y,v as G,W as H}from"./index-2c69281d.js";import{A as Q}from"./AuthTokenAdmin-013c9de1.js";import{S as R}from"./sweetalert2.all-34f271eb.js";import{M as J}from"./index-51d0348b.js";import{L as K}from"./label-282cadd9.js";import{F as c,T as y,I as T,S as W}from"./TextField-d07e4572.js";import{C as X}from"./Container-bfd5118f.js";import{C as ee}from"./Card-d7aae708.js";import"./TableSortLabel-69ccbb78.js";import"./KeyboardArrowRight-13bf3a5b.js";const se={filter:!1,selectableRows:"none",rowsPerPage:10,rowsPerPageOptions:[5,10,20],responsive:"standard",tableBodyHeight:"420px",download:!1,print:!1,viewColumns:!1},$=[{id:1,name:"QA"}],F=[{id:1,name:"Inspector"},{id:2,name:"Admin"}];function Z({isOpen:n,onClose:N,baseURL:h,getAllUsers:E}){const j=()=>{N(!1)},[u,p]=a.useState(""),[z,x]=a.useState(""),[S,g]=a.useState(""),[O,b]=a.useState(""),[w,C]=a.useState(""),[v,U]=a.useState("");console.log(w);const f={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:"15px",boxShadow:"rgba(158, 199, 243, 0.65) 0 0 15px 2px",pt:2,px:4,pb:3};function A(t){return t.length>0?`${t.charAt(0).toUpperCase()}${t.slice(1)}`:""}const B=()=>{p(""),x(""),g(""),b(""),U(""),C("")},d=async()=>{await M.post(`${h}/backend_qc_inspection/api`,{router:"addUser",username:u,fname:A(z),lname:A(S),department:O,position:v,role:w}).then(t=>{t.data.err?R.fire({icon:"error",title:t.data.msg}):!t.data.err&&t.data.status==="Ok"&&(R.fire({icon:"success",title:t.data.msg,timer:700,showCancelButton:!1,showConfirmButton:!1}),j(),E(),B())}).catch(t=>{console.log(t)})};return e.jsx("div",{children:e.jsx(P,{open:n,onClose:j,children:e.jsxs(I,{sx:{...f,height:"90%",overflow:"hidden",overflowY:"auto"},className:"w-[80%] lg:w-[50%]",children:[e.jsx("button",{type:"button",className:" absolute top-0 right-0 mx-[1rem] mt-[0.6rem]",onClick:()=>j(),children:e.jsx("i",{className:"fa-solid fa-xmark text-[red] text-[18px]"})}),e.jsxs("h4",{className:"font-bold",children:[e.jsx("i",{className:"fa-regular fa-user text-[18px] mr-1"}),"Add User"]}),e.jsx(I,{className:"flex justify-center",children:e.jsxs(I,{className:"w-[400px]",children:[e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Username :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Username",onChange:t=>{const o=/^[a-zA-Z0-9]*$/,s=t.target.value.replace(/[^a-zA-Z]/g,"");o.test(s)?p(s):console.log("Only English characters are allowed.")},value:u}),e.jsx("span",{className:"text-[red] text-[12px] mt-[0.5rem]",children:"* ใส่ User Ad ที่ใช้ Login เข้า Computer เช่น swd"})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Firstname (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Firstname",onChange:t=>{const o=/^[a-zA-Z0-9]*$/,s=t.target.value.replace(/[^a-zA-Z]/g,"");o.test(s)?x(s):console.log("Only English characters are allowed.")},value:z})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Lastname (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Lastname",onChange:t=>{const o=/^[a-zA-Z0-9]*$/,s=t.target.value.replace(/[^a-zA-Z]/g,"");o.test(s)?g(s):console.log("Only English characters are allowed.")},value:S})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Position (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Position",onChange:t=>{const o=/^[a-zA-Z0-9\s]*$/,s=t.target.value.replace(/[^a-zA-Z0-9\s]/g,"");o.test(s)?U(s):console.log("Only English characters are allowed.")},value:v})]}),e.jsx(i,{children:"Department :"}),e.jsxs(c,{fullWidth:!0,sx:{marginTop:1},size:"small",children:[e.jsx(T,{id:"demo-select-small-label",children:"Department"}),e.jsx(W,{labelId:"demo-select-small-label",id:"demo-select-small",value:O,onChange:t=>b(t.target.value),label:"Department",children:$.map((t,o)=>e.jsx(L,{value:t.name,children:t.name},o))})]}),e.jsx(i,{sx:{marginTop:1},children:"Role :"}),e.jsxs(c,{fullWidth:!0,sx:{marginTop:1},size:"small",children:[e.jsx(T,{id:"demo-select-small-label",children:"Role"}),e.jsx(W,{labelId:"demo-select-small-label",id:"demo-select-small",value:w,onChange:t=>C(t.target.value),label:"Role",children:F.map((t,o)=>e.jsx(L,{value:t.name,children:t.name},o))})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsx(D,{onClick:d,variant:"contained",children:"Submit"})})]})})]})})})}Z.propTypes={isOpen:m.bool,onClose:m.func,baseURL:m.string,getAllUsers:m.func};function _({user:n,isOpen:N,onClose:h,baseURL:E,getAllUsers:j,id:u}){const p=()=>{h(!1)},[z,x]=a.useState(""),[S,g]=a.useState(""),[O,b]=a.useState(""),[w,C]=a.useState(""),[v,U]=a.useState(""),[f,A]=a.useState("");console.log(v);const B={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:"15px",boxShadow:"rgba(158, 199, 243, 0.65) 0 0 15px 2px",pt:2,px:4,pb:3};function d(s){return s.length>0?`${s.charAt(0).toUpperCase()}${s.slice(1)}`:""}const t=()=>{x(""),g(""),b(""),C(""),A(""),U("")},o=async()=>{await M.post(`${E}/backend_qc_inspection/api`,{router:"updateUser",username:z,fname:d(S),lname:d(O),department:w,position:f,role:v,id:u}).then(s=>{s.data.err?R.fire({icon:"error",title:s.data.msg}):!s.data.err&&s.data.status==="Ok"&&(R.fire({icon:"success",title:s.data.msg,timer:700,showCancelButton:!1,showConfirmButton:!1}),p(),j(),t())}).catch(s=>{console.log(s)})};return a.useEffect(()=>{var s,l;x(n.LOGIN_DOMAIN),g((s=n.FULLNAME)==null?void 0:s.split(" ")[0]),b((l=n.FULLNAME)==null?void 0:l.split(" ")[1]),C(n.DEPARTNAME),A(n.POSITION),U(n.ROLE),console.log("userProps",n)},[n]),e.jsx("div",{children:e.jsx(P,{open:N,onClose:p,children:e.jsxs(I,{sx:{...B,height:"90%",overflow:"hidden",overflowY:"auto"},className:"w-[80%] lg:w-[50%]",children:[e.jsx("button",{type:"button",className:" absolute top-0 right-0 mx-[1rem] mt-[0.6rem]",onClick:()=>p(),children:e.jsx("i",{className:"fa-solid fa-xmark text-[red] text-[18px]"})}),e.jsxs("h4",{className:"font-bold",children:[e.jsx("i",{className:"fa-regular fa-user text-[18px] mr-1"}),"Update User ",u]}),e.jsx(I,{className:"flex justify-center",children:e.jsxs(I,{className:"w-[400px]",children:[e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Username :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Username",onChange:s=>{const l=/^[a-zA-Z0-9]*$/,r=s.target.value.replace(/[^a-zA-Z]/g,"");l.test(r)?x(r):console.log("Only English characters are allowed.")},value:z}),e.jsx("span",{className:"text-[red] text-[12px] mt-[0.5rem]",children:"* ใส่ User Ad ที่ใช้ Login เข้า Computer เช่น swd"})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Firstname (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Firstname",onChange:s=>{const l=/^[a-zA-Z0-9]*$/,r=s.target.value.replace(/[^a-zA-Z]/g,"");l.test(r)?g(r):console.log("Only English characters are allowed.")},value:S})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Lastname (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Lastname",onChange:s=>{const l=/^[a-zA-Z0-9]*$/,r=s.target.value.replace(/[^a-zA-Z]/g,"");l.test(r)?b(r):console.log("Only English characters are allowed.")},value:O})]}),e.jsxs(c,{fullWidth:!0,sx:{marginBottom:1},children:[e.jsx(i,{children:"Position (English) :"}),e.jsx(y,{fullWidth:!0,size:"small",placeholder:"Position",onChange:s=>{const l=/^[a-zA-Z0-9\s]*$/,r=s.target.value.replace(/[^a-zA-Z0-9\s]/g,"");l.test(r)?A(r):console.log("Only English characters are allowed.")},value:f})]}),e.jsx(i,{children:"Department :"}),e.jsxs(c,{fullWidth:!0,sx:{marginTop:1},size:"small",children:[e.jsx(T,{id:"demo-select-small-label",children:"Department"}),e.jsx(W,{labelId:"demo-select-small-label",id:"demo-select-small",value:w,onChange:s=>C(s.target.value),label:"Department",children:$.map((s,l)=>e.jsx(L,{value:s.name,children:s.name},l))})]}),e.jsx(i,{sx:{marginTop:1},children:"Role :"}),e.jsxs(c,{fullWidth:!0,sx:{marginTop:1},size:"small",children:[e.jsx(T,{id:"demo-select-small-label",children:"Role"}),e.jsx(W,{labelId:"demo-select-small-label",id:"demo-select-small",value:v,onChange:s=>U(s.target.value),label:"Role",children:F.map((s,l)=>e.jsx(L,{value:s.name,children:s.name},l))})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsx(D,{onClick:o,variant:"contained",children:"Submit"})})]})})]})})})}_.propTypes={isOpen:m.bool,user:m.object,onClose:m.func,baseURL:m.string,getAllUsers:m.func,id:m.number};function te(){const[n,N]=a.useState([]),h="http://backend-qcinspection",[E,j]=a.useState(null),[u,p]=a.useState(null),[z,x]=a.useState(!1),[S,g]=a.useState(!1),[O,b]=a.useState({}),w=s=>{const l=n==null?void 0:n.find(r=>parseInt(r.USER_ID,10)===parseInt(s,10));b(l)},C=()=>{x(!0)},v=()=>{g(!0)},U=(s,l)=>{j(s.currentTarget),p(l),w(l)};console.log(u);const f=()=>{j(null)},A=()=>{x(!1),f()},B=()=>{g(!1),f()},d=a.useCallback(async()=>{await M.post(`${h}/backend_qc_inspection/api`,{router:"allUsers"}).then(s=>{s.data.err?N([]):!s.data.err&&s.data.status==="Ok"&&N(s.data.results)}).catch(s=>{console.log(s)})},[h]),t=[{name:"No",label:"Row #"},{name:"LOGIN_DOMAIN",label:"Login Domain"},{name:"FULLNAME",label:"Fullname"},{name:"ROLE",label:"Role",options:{customBodyRender:(s,l)=>e.jsx(K,{color:l.rowData[3]==="Inspector"&&"info"||"primary",children:l.rowData[3]})}},{name:"USER_ID",label:"Action",options:{filter:!0,sort:!1,customBodyRender:(s,l)=>{const r=l.rowData[4];return e.jsx(G,{style:{cursor:"pointer"},onClick:V=>U(V,r),children:e.jsx(k,{icon:"eva:more-vertical-fill"})})}}}],o=async s=>{const l=await M.post(`${h}/backend_qc_inspection/api`,{router:"deleteUser",id:u});l.data.err?R.fire({icon:"error",title:l.data.msg}):!l.data.err&&l.data.status==="Ok"&&(R.fire({icon:"success",title:l.data.msg,showCancelButton:!1,showConfirmButton:!1,timer:700}),d(),f(),p(null))};return a.useEffect(()=>{d()},[d]),e.jsxs(X,{children:[e.jsx(Z,{getAllUsers:d,isOpen:z,onClose:A,baseURL:h}),e.jsx(_,{user:O,getAllUsers:d,isOpen:S,onClose:B,baseURL:h,id:u}),e.jsxs(q,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(i,{variant:"h4",children:"Users"}),e.jsx(D,{variant:"contained",color:"inherit",startIcon:e.jsx(k,{icon:"eva:plus-fill"}),onClick:C,children:"New User"})]}),e.jsxs(ee,{children:[e.jsxs(Y,{open:!!E,anchorEl:E,onClose:f,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsxs(L,{onClick:v,children:[e.jsx(k,{icon:"eva:edit-fill",sx:{mr:2}}),"Edit"]}),e.jsxs(L,{sx:{color:"error.main"},onClick:()=>{R.fire({title:"Are you sure?",text:"คุณจะไม่สามารถกู้ข้อมูลกลับมาได้!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(s=>{s.isConfirmed&&o()})},children:[e.jsx(k,{icon:"eva:trash-2-outline",sx:{mr:2}}),"Delete"]})]}),e.jsx(J,{columns:t,data:n,options:se,title:e.jsxs("p",{style:{fontSize:15},children:["Table showing user information in the system (",n==null?void 0:n.length," users)"]})})]})]})}function ue(){return e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(H,{children:e.jsx("title",{children:" Lists | Users Master"})}),e.jsx(te,{})]})}export{ue as default};
