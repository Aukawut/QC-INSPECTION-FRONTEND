import{r as l,h as e,M as qe,Y as pt,n as N,T as f,B as X,P as Q,m as z,y as mt,Z as Dt,$ as Xt,o as pa,O as ma,N as ha,W as xa}from"./index-036dc118.js";import{A as fa}from"./AuthToken-b03ed466.js";import{S as ze}from"./sweetalert2.all-d11f4fde.js";import{M as zt}from"./index-a4770ec5.js";import{L as Ye}from"./label-f2919946.js";import{T as $t,b as Jt,c as at,d as st,i as Na,X as ga,R as Ca}from"./RBarChart-0e816ac3.js";import{M as Sa}from"./modal-control-chart-f9520399.js";import{T as H,F as La,I as ja,S as ya}from"./TextField-c50dbb77.js";import{G as dt}from"./KeyboardArrowRight-03236054.js";import"./TableSortLabel-1e2a7b46.js";const Bt={filter:!1,selectableRows:"none",rowsPerPage:10,rowsPerPageOptions:[5,10,20],responsive:"standard",tableBodyHeight:"420px",download:!1,print:!1,viewColumns:!1};function ht({inspectionNgByPoint:g,inspectionNg:o,handleClose:Re,isOpen:E,objHistory:y,style:d,standard:w,controlData:c}){var Me,h;return l.useEffect(()=>{console.log("modalinspectionNgByPoint",g),console.log("Ok is Mouse!"),console.log("Ok is Mouse!",c)},[g,o,c]),e.jsx("div",{children:e.jsx(qe,{open:E,onClose:Re,children:e.jsx(pt,{in:E,timeout:300,children:e.jsxs(N,{sx:{...d},width:"80%",height:"90%",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(f,{children:[e.jsx("i",{className:"fa-solid fa-clock-rotate-left mr-2"}),"History"]}),e.jsxs(X,{variant:"outlined",size:"small",color:"error",onClick:Re,children:[e.jsx("i",{className:"fa-solid fa-xmark mr-2"}),"Close"]})]}),e.jsxs(N,{padding:1,height:"80%",width:"100%",overflow:"auto",marginTop:2,children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsxs(f,{fontWeight:"bold",children:[y.psthPartNo," #",y.moldProps]}),e.jsx(Ye,{color:"primary",children:(Me=w[0])==null?void 0:Me.JUST_ON})]}),e.jsx("i",{className:"fa-regular fa-clock mr-2"}),e.jsx(f,{variant:"caption",fontSize:14,marginRight:1,children:y.dateProps}),e.jsxs(f,{variant:"caption",fontSize:14,children:["รอบเวลา ",y.timeProps," น."]})]}),e.jsxs(N,{children:[e.jsx("i",{className:"fa-regular fa-user"})," ",(h=o[0])==null?void 0:h.INSPECTOR]}),e.jsx("div",{className:"text-[1rem] relative overflow-x-auto mt-[1rem] grid grid-cols-1 sm:grid-cols-2 gap-x-2",children:g==null?void 0:g.map((K,n)=>{var B,Y,G,Ve,W,D,V,Ee,te,De,$e,He;const $=K==null?void 0:K.filter(S=>parseInt(S.POINT_NO,10)===n+1),p=$==null?void 0:$.filter(S=>parseInt(S.SIMPLE,10)===1),R=$==null?void 0:$.filter(S=>parseInt(S.SIMPLE,10)===2);let J=0,ee=0;return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs(f,{fontSize:12,children:[e.jsx("i",{className:"fa-solid fa-angles-right text-[red] mr-2"}),"Point No. ",n+1]}),e.jsxs(f,{fontSize:12,children:["SPEC : ",`${(B=w[n])==null?void 0:B.LSL} - ${(Y=w[n])==null?void 0:Y.USL}`," mm"]}),e.jsxs(f,{fontSize:12,children:["Control Chart: ",`${(G=c[n])==null?void 0:G.LCL} - ${(Ve=c[n])==null?void 0:Ve.UCL}`," ","mm"]}),e.jsxs(f,{fontSize:12,children:["* UCL,LCL คำนวณจาก : ",`${y.dateProps} ${y.timeProps}`," ","Last 100 Data"]})]},n),e.jsxs("table",{className:"border-2 mt-[1rem] w-[100%] text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-5 py-4 text-center",children:"No."}),e.jsx("th",{scope:"col",className:"px-5 py-4 text-center",children:"Direction"}),e.jsx("th",{scope:"col",className:"px-5 py-4 text-center",children:"Sample 1"}),e.jsx("th",{scope:"col",className:"px-5 py-4 text-center",children:"Sample 2"})]})}),e.jsxs("tbody",{children:[p==null?void 0:p.map((S,u)=>{var v,A,O,_,q,Ge,I,C,x,F,P,j,k,Je;return J+=parseFloat(p[u].INSPECTION_VALUE),ee+=parseFloat(R[u].INSPECTION_VALUE),e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 text-center",children:u+1}),e.jsx("td",{className:"p-2 text-center",children:S.NAME_RESULT}),e.jsx("td",{className:`p-2 text-center ${((v=w[n])==null?void 0:v.JUST_ON)==="X,Y"&&parseFloat((A=p[u])==null?void 0:A.INSPECTION_VALUE)>parseFloat((O=c[n])==null?void 0:O.UCL)||((_=w[n])==null?void 0:_.JUST_ON)==="X,Y"&&parseFloat((q=p[u])==null?void 0:q.INSPECTION_VALUE)<parseFloat((Ge=c[n])==null?void 0:Ge.LCL)?"text-red-400":""}`,children:(I=p[u])==null?void 0:I.INSPECTION_VALUE}),e.jsx("td",{className:`p-2 text-center ${((C=w[n])==null?void 0:C.JUST_ON)==="X,Y"&&parseFloat((x=R[u])==null?void 0:x.INSPECTION_VALUE)>parseFloat((F=c[n])==null?void 0:F.UCL)||((P=w[n])==null?void 0:P.JUST_ON)==="X,Y"&&parseFloat((j=R[u])==null?void 0:j.INSPECTION_VALUE)<parseFloat((k=c[n])==null?void 0:k.LCL)?"text-red-400":""}`,children:(Je=R[u])==null?void 0:Je.INSPECTION_VALUE})]},u)}),e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 text-center",colSpan:2,children:e.jsx(f,{fontSize:15,fontWeight:"bold",children:"AVG"})}),e.jsx("td",{className:`p-2 text-center bg-slate-200 font-bold ${(J/p.length).toFixed(2)<((W=c[n])==null?void 0:W.LCL)&&((D=w[0])==null?void 0:D.JUST_ON)==="AVG"||(J/p.length).toFixed(2)>((V=c[n])==null?void 0:V.UCL)&&((Ee=w[0])==null?void 0:Ee.JUST_ON)==="AVG"?"text-[red]":""}`,children:p&&p.length>0?(J/p.length).toFixed(2):"..."}),e.jsx("td",{className:`p-2 text-center bg-slate-200 font-bold ${(ee/R.length).toFixed(2)<((te=c[n])==null?void 0:te.LCL)&&((De=w[0])==null?void 0:De.JUST_ON)==="AVG"||(ee/R.length).toFixed(2)>(($e=c[n])==null?void 0:$e.UCL)&&((He=w[0])==null?void 0:He.JUST_ON)==="AVG"?"text-[red]":""}`,children:R&&R.length>0?(ee/R.length).toFixed(2):"..."})]})]})]})]},n)})})]})]})})})})}ht.propTypes={isOpen:Q.bool,handleClose:Q.func,objHistory:Q.object,inspectionNg:Q.array,inspectionNgByPoint:Q.array,standard:Q.array,style:Q.object,controlData:Q.any};const va=Xt({typography:{fontFamily:"Prompt, sans-serif"},components:{MuiPaper:{styleOverrides:{root:{boxShadow:"none",borderRadius:"15px"}}},MuiTable:{styleOverrides:{root:{boxShadow:"none"}}},MuiTableCell:{styleOverrides:{root:{padding:"10px",textAlign:"center"}}}}});function _a(){const[g,o]=l.useState([]),[Re,E]=l.useState(!1),[y,d]=l.useState(!1),[w,c]=l.useState([]),[Me,h]=l.useState([]),[K,n]=l.useState({}),[$,p]=l.useState(!1),[R,J]=l.useState([]),[ee,B]=l.useState([]),Y="http://backend-qcinspection",G=()=>{p(!1)},Ve=()=>{p(!0)},W=l.useCallback(async(S,u,v,A,O)=>{await z.post(`${Y}/backend_qc_inspection/api`,{router:"getXBarUCL",psthPartNo:A,n:2,dateInspection:`${v} ${O}:00`,MoldNo:u,top:S}).then(_=>{_.data.err&&_.data.msg!=="Not Found!"?B([]):!_.data.err&&_.data.status==="Ok"?B(_.data.result):_.data.err&&_.data.msg==="Not Found!"&&ze.fire({icon:"warning",title:"Not Found!",text:"ไม่พบ Data ที่จะคำนวณ UCL LCL"})}).catch(_=>{console.log(_)})},[Y]),D=l.useCallback(async()=>{await z.post(`${Y}/backend_qc_inspection/api`,{router:"getInspectionFG"}).then(S=>{E(!0),S.data.err?console.log(S.data.msg):!S.data.err&&S.data.status==="Ok"?(o(S.data.result),E(!1)):o([])}).catch(S=>{console.log(S)})},[Y]);console.log(g);const V=l.useCallback(S=>{const u={};return S.forEach(v=>{u[v.POINT_NO]||(u[v.POINT_NO]=[]),u[v.POINT_NO].push(v)}),Object.values(u).sort((v,A)=>v[0].point-A[0].point)},[]),Ee=async(S,u,v,A)=>{await z.post(`${Y}/backend_qc_inspection/api`,{router:"getInspectionPartByDatetime",psthPartNo:S,date:u,time:v,mold:A}).then(O=>{if(O.data.err)console.log(O.data.msg);else if(!O.data.err&&O.data.status==="Ok"){c(O.data.result);const _=V(O.data.result);h(_),setTimeout(()=>{Ve()},300)}}).catch(O=>{console.log(O)})},te=async S=>{await z.post(`${Y}/backend_qc_inspection/api`,{router:"getStandardByPart",bsthPartNo:S}).then(u=>{u.data.err?console.log(u.data.msg):!u.data.err&&u.data.status==="Ok"&&J(u.data.result)}).catch(u=>{console.log(u)})};console.log("inspectionNg",w),console.log("inspectionNgByPoint",Me);const De=[{name:"NO",label:"Row #"},{name:"BSNCR_PART_NO",label:"PSTH Part No"},{name:"LOT_NO",label:"LOT_NO"},{name:"DATE",label:"Date"},{name:"MOLD_NO",label:"MOLD_NO"},{name:"TIME",label:"Time",options:{customBodyRender:(S,u)=>e.jsx(Ye,{color:"primary",children:u.rowData[5]})}},{name:"NG",label:"Result",options:{customBodyRender:(S,u)=>e.jsx(Ye,{color:parseInt(u.rowData[6],10)>0&&"error"||"success",children:parseInt(u.rowData[6],10)>0?"NG":"FG"})}},{name:"INSPECTOR",label:"Inspector"},{name:"action",label:"Action",options:{customBodyRender:(S,u)=>u.rowData[9]==="Y"&&u.rowData[10]?e.jsxs(X,{type:"button",style:{cursor:"pointer"},size:"small",variant:"outlined",onClick:()=>{const v=u.rowData[1],A=u.rowData[3],O=u.rowData[4],_=u.rowData[5];n({psthPartNo:v,dateProps:A,moldProps:O,timeProps:_}),Ee(v,A,_,O),te(v),W(100,O,A,v,_)},children:[e.jsx("i",{className:"fa-regular fa-eye mr-2"})," View"]}):e.jsxs(X,{type:"button",style:{cursor:"pointer"},size:"small",variant:"outlined",onClick:()=>{const v=u.rowData[1],A=u.rowData[3],O=u.rowData[4],_=u.rowData[5];n({psthPartNo:v,dateProps:A,moldProps:O,timeProps:_}),Ee(v,A,_,O),te(v),W(100,O,A,v,_)},children:[e.jsx("i",{className:"fa-regular fa-eye mr-2"})," View"]})}},{name:"APPROVE",label:"APPROVE",options:{display:!1}},{name:"WAIT_REINSPECTION",label:"WAIT_REINSPECTION",options:{display:!1}}],$e={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:"4px",boxShadow:"rgba(158, 199, 243, 0.65) 0 0 15px 2px",pt:2,px:4,pb:3},He=mt(S=>S.isChange);return l.useEffect(()=>{D()},[D,He]),e.jsxs("div",{children:[e.jsx(ht,{inspectionNg:w,inspectionNgByPoint:Me,objHistory:K,isOpen:$,handleClose:G,style:$e,standard:R,controlData:ee}),e.jsx(f,{variant:"h4",children:"History"}),e.jsx(qe,{open:y,onClose:()=>d(!1),children:e.jsx(pt,{in:y,timeout:300,children:e.jsx(N,{sx:{...$e},width:"100%",height:"100%",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h4",{className:"font-bold",children:[e.jsx("i",{className:"fa-solid fa-reply mr-2"}),"Re Check Data"]}),e.jsxs(X,{variant:"outlined",color:"error",onClick:()=>{d(!1)},children:[e.jsx("i",{className:"fa-solid fa-xmark mr-1"}),"Close"]})]})})})}),Re?e.jsx("p",{children:"Loading ..."}):e.jsx(Dt,{theme:va,children:e.jsx(zt,{options:Bt,columns:De,data:g})})]})}const ut=[{id:1,time:"09:00"},{id:2,time:"13:00"},{id:3,time:"17:00"},{id:4,time:"21:00"},{id:5,time:"01:00"},{id:6,time:"05:00"}],Oa=[{id:1,data:30},{id:2,data:50},{id:3,data:100}],Yt=({psthPartNo:g,obj:o,handleCloseModal:Re,oldCavityList:E})=>{var Ut,kt,wt,At,Pt,It,Rt,Mt;const y="http://backend-qcinspection",[d,w]=l.useState([]),[c,Me]=l.useState([]),[h,K]=l.useState([]),[n,$]=l.useState([]),[p,R]=l.useState([]),[J,ee]=l.useState((Ut=E[0])==null?void 0:Ut.CAVITY_NO),[B,Y]=l.useState((kt=E[1])==null?void 0:kt.CAVITY_NO),[G,Ve]=l.useState(o==null?void 0:o.LOT_NO),[W,D]=l.useState(o==null?void 0:o.MOLD_NO),[V,Ee]=l.useState(o==null?void 0:o.TIME),[te,De]=l.useState(o.INSPECTOR),[$e,He]=l.useState(""),[S,u]=l.useState([]),[v,A]=l.useState([]),[O,_]=l.useState([]),[q,Ge]=l.useState(new Date),[I,C]=l.useState([]),[x,F]=l.useState(""),[P,j]=l.useState(!1),k=mt(a=>a.render),[Je,Vt]=l.useState(100),[Ht,xt]=l.useState("1"),[lt,ft]=l.useState([]),[Nt,gt]=l.useState(""),[Gt,Qe]=l.useState(!1),[Wt,Ct]=l.useState(!1),[qt,et]=l.useState(!1),Ke=l.useRef(null),ae=l.useRef([]),Xe=l.useRef([]),ot=l.useRef(null),St=l.useRef(null),tt=l.useRef(null),Kt=l.useRef(null),Zt=l.useRef(null),Lt=l.useRef(null),rt=l.useRef([]);console.log("oldCavityList",E);const nt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:"15px",boxShadow:"rgba(158, 199, 243, 0.65) 0 0 15px 2px",pt:2,px:4,pb:3},[Qt,jt]=l.useState(!1),ea=()=>{jt(!0);const a=h.map((t,r)=>({AMOUNT:t.AMOUNT,AVG_R:t.AVG_R,AVG_X:t.AVG_X,BSNCR_PART_NO:t.BSNCR_PART_NO,LCL_MANUAL:t.LCL,MOLD_NO:t.MOLD_NO,POINT_NO:t.POINT_NO,R_LCL_MANUAL:t.R_LCL,R_UCL_MANUAL:t.R_UCL,SUM_R:t.SUM_R,SUM_X:t.SUM_X,UCL_MANUAL:t.UCL}));C(a)},ta=a=>{const t=a.target.value;(/^\d{1}-\d{1,2}$|^\d{1}-$|^\d{1}$/.test(t)||t==="")&&ee(t)},aa=a=>{const t=a.target.value;(/^\d{1}-\d{1,2}$|^\d{1}-$|^\d{1}$/.test(t)||t==="")&&Y(t)},ct=()=>{jt(!1),xt("1")};console.log("btnTimeRef",rt);const yt=l.useCallback(async()=>{const a=await z.post(`${y}/backend_qc_inspection/api`,{router:"getStandardByPart",bsthPartNo:g.partNo});a.data.err?console.log(a.data.msg):!a.data.err&&a.data.status==="Ok"&&Me(a.data.result)},[y,g.partNo]),vt=l.useCallback(async()=>{await z.post(`${y}/backend_qc_inspection/api`,{router:"getStandardInspection",bsthPartNo:g.partNo}).then(a=>{if(a.data.err)w([]);else if(a.data.status==="Ok"&&!a.data.err){w(a.data.result);const t=a.data.result.filter(i=>parseInt(i.POINT_NO,10)===1),r=[],L=[];for(let i=1;i<=parseInt(a.data.result[0].AMOUNT_POINT,10);i+=1)r.push({valueCheck:t.map((s,T)=>({id_result:parseInt(s.ID_RESULT,10),name_result:s.NAME_RESULT,lsl:s.LSL,usl:s.USL,value:"",point:i}))}),L.push({valueCheck:t.map((s,T)=>({id_result:parseInt(s.ID_RESULT,10),name_result:s.NAME_RESULT,lsl:s.LSL,usl:s.USL,value2:"",point:i}))});$(r),R(L)}}).catch(a=>{console.log(a)})},[y,g.partNo]);console.log("standardPart",c);const _t=(a,t,r)=>{if(!/^\d+(\.\d{0,2})?$/.test(a)&&a!==""){console.error("Invalid float format. Expected format: xx.xx");return}const i=[...n];i[t].valueCheck[r].value=a,$(i)},Ot=(a,t,r)=>{if(!/^\d+(\.\d{0,2})?$/.test(a)&&a!==""){console.error("Invalid float format. Expected format: xx.xx");return}const i=[...p];i[t].valueCheck[r].value2=a,R(i)},sa=(a,t,r)=>{a.key==="Enter"&&(r<ae.current[t].length-1?ae.current[t][r+1].focus():t<ae.current.length-1&&ae.current[t+1][0].focus(),r===ae.current[t].length-1&&t===ae.current.length-1&&(console.log("ถึงตัวสุดท้าย"),St.current.focus(),Ke.current.scrollTop=0))},la=(a,t,r)=>{a.key==="Enter"&&a.key==="Enter"&&(r<Xe.current[t].length-1?Xe.current[t][r+1].focus():t<Xe.current.length-1&&Xe.current[t+1][0].focus(),r===Xe.current[t].length-1&&t===Xe.current.length-1&&(console.log("ถึงตัวสุดท้าย"),ot.current.value===""?ot.current.focus():Lt.current.focus()))},oa=()=>{var L,i;let a=0,t=0;const r=(s,T)=>{/^\d+\.\d{2}$/.test(s)||(T===1?a+=1:T===2&&(t+=1))};for(let s=0;s<n.length;s+=1)(L=n[s].valueCheck)==null||L.map(T=>r(T.value,1)),(i=p[s].valueCheck)==null||i.map(T=>r(T.value2,2));return!(a!==0||t!==0)},ra=()=>{De(""),Ve(""),Ee(""),D(""),ee(""),Y("")},na=()=>{Ke.current.scrollTop=0,tt.current.focus(),document.documentElement.scrollTop=0,document.body.scrollTop=0},Ft=(a,t,r)=>{const L=/^\d+(\.\d{0,2})?$/;console.log(L);const i=[...I];if(!L.test(a)&&a!==""){console.log("Format Error");return}r==="lcl"?i[t].LCL_MANUAL=a:r==="ucl"&&(i[t].UCL_MANUAL=a),C(i)},[ca,bt]=l.useState(!1),ia=()=>{const a=/^\d+\.\d{2}$/;let t=0,r=0,L=0;for(let i=0;i<(h==null?void 0:h.length);i+=1)(!a.test(I[i].UCL_MANUAL)||I[i].UCL_MANUAL==="")&&(t+=1),(!a.test(I[i].LCL_MANUAL)||I[i].LCL_MANUAL==="")&&(r+=1),parseFloat(I[i].LCL_MANUAL)>I[i].UCL_MANUAL&&(L+=1);if(t!==0||r!==0)ze.fire({icon:"warning",title:"Error Format",text:"ระบุทศนิยม 2 ตำแหน่งเท่านั้น"});else if(L!==0)ze.fire({icon:"warning",title:"Error Value LCL UCL",text:"ค่า LCL UCL ไม่ถูกต้อง"});else{const i=I.map((s,T)=>({AMOUNT:s.AMOUNT,AVG_R:s.AVG_R,AVG_X:s.AVG_X,BSNCR_PART_NO:s.BSNCR_PART_NO,LCL:s.LCL_MANUAL,MOLD_NO:s.MOLD_NO,POINT_NO:s.POINT_NO,R_LCL:s.R_LCL_MANUAL,R_UCL:s.R_UCL_MANUAL,SUM_R:s.SUM_R,SUM_X:s.SUM_X,UCL:s.UCL_MANUAL}));K(i),ct(),bt(!0)}console.log(t),console.log(r),console.log(a)},da=async()=>{await z.post(`${y}/backend_qc_inspection/api`,{router:"UpdateInspection",bsthPartNo:g.partNo,inspector:te,lotNo:G,moldNo:W,time:V,date:o.DATE,value:[{simple:1,cavity:J,valueCheck:n},{simple:2,cavity:B,valueCheck:p}]}).then(a=>{a.data.err?ze.fire({icon:"error",title:a.data.msg}):!a.data.err&&a.data.status==="Ok"&&(ze.fire({icon:"success",title:a.data.msg,timer:600,showCancelButton:!1,showConfirmButton:!1}).then(()=>{k(),ra(),et(!1),Re()}),setTimeout(()=>{na()},1500)),console.log(a.data)}).catch(a=>{console.log(a)})},ua=async()=>{const a=/^\d{1}-\d{1,2}$/.test(J),t=/^\d{1}-\d{1,2}$/.test(B);G===""||W===""||V===""||J===""||B===""||te===""?ze.fire({icon:"warning",title:"Error Input From",text:"กรุณากรอกข้อมูลให้ครบถ้วน"}):oa()?!a||!t?ze.fire({icon:"warning",title:"Format Cavity ไม่ถูกต้อง",text:"กรุณาระบุ Format x-x หรือ x-xx เท่านั้น"}):et(!0):ze.fire({icon:"warning",title:"Format ไม่ถูกต้อง",text:"กรุณาระบุเลขทศนิยม 2 ตำแหน่ง"})},it=l.useCallback(async(a,t,r)=>{await z.post(`${y}/backend_qc_inspection/api`,{router:"getDataXBarChart",psthPartNo:g.partNo,moldNo:a,dateInspection:`${t} ${r}:00`}).then(L=>{L.data.err?(console.log(L.data.msg),u([])):u(L.data.result)}).catch(L=>{console.log(L)})},[y,g.partNo]),Ze=l.useCallback(async(a,t,r,L)=>{Qe(!0),await z.post(`${y}/backend_qc_inspection/api`,{router:"getXBarUCL",psthPartNo:g.partNo,n:2,dateInspection:`${r} ${L}:00`,MoldNo:t,top:a}).then(i=>{var s,T;i.data.err&&i.data.msg!=="Not Found!"?(K([]),Qe(!1)):!i.data.err&&i.data.status==="Ok"?(K(i.data.result),A((s=i.data.result[0])==null?void 0:s.MAX),_((T=i.data.result[1])==null?void 0:T.MIN),Qe(!1),ct(),bt(!1)):i.data.err&&i.data.msg==="Not Found!"&&(ze.fire({icon:"warning",title:"Not Found!",text:"ไม่พบ Data ที่จะคำนวณ"}),Qe(!1))}).catch(i=>{console.log(i)})},[y,g.partNo]),Tt=l.useCallback(async()=>{await z.post(`${y}/backend_qc_inspection/api`,{router:"countMoldOfPsthPart",psthPartNo:g.partNo}).then(a=>{a.data.err?ft([]):!a.data.err&&a.data.status==="Ok"&&(ft(a.data.result),gt(a.data.result[0].MOLD_NO),He(o==null?void 0:o.DATE),Ze(100,a.data.result[0].MOLD_NO,o==null?void 0:o.DATE,o==null?void 0:o.TIME),it(a.data.result[0].MOLD_NO,o==null?void 0:o.DATE,o==null?void 0:o.TIME))}).catch(a=>{console.log(a)})},[y,g.partNo,Ze,it,o]);return console.log($e),l.useEffect(()=>{console.log("Effefct"),vt(),yt(),Tt(),tt.current.focus(),Ke.current.scrollTop=0},[vt,yt,tt,Ke,Tt,Ze]),e.jsxs("div",{ref:Ke,style:{overflowY:"auto",maxHeight:"calc(100vh - 100px)"},children:[e.jsx(Sa,{isOpen:P,handleClose:()=>j(!1)}),e.jsx(qe,{open:Qt,onClose:ct,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(N,{sx:{...nt,height:"80%",overflow:"hidden",overflowY:"auto"},className:"w-[80%] lg:w-[50%]",children:e.jsxs($t,{value:Ht,children:[e.jsx(N,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Jt,{onChange:(a,t)=>xt(t),"aria-label":"lab API tabs example",children:[e.jsx(at,{label:"Calculate",value:"1"}),e.jsx(at,{label:"Input Manual",value:"2"})]})}),e.jsxs(st,{value:"1",children:[e.jsxs("h2",{children:[e.jsx("i",{className:"fa-solid fa-calculator text-[17px] mr-2"}),"Calculate | UCL , LCL (",g.partNo,")"]}),e.jsxs(N,{className:"mt-[2rem]",children:[e.jsx(Na,{maxDate:new Date,onChange:a=>Ge(a),dateFormat:"dd MMMM yyyy",selected:q,customInput:e.jsx(H,{value:q,id:"standard-basic",label:"Date",placeholder:"เลือกวันที่",variant:"standard"})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-[1rem]",children:Oa.map((a,t)=>e.jsx("button",{value:a.data,type:"button",onClick:r=>{Vt(r.target.value)},className:`p-[5px] flex justify-center rounded-[5px] ${a.data===parseInt(Je,10)?"bg-violet-400 text-white transition-all duration-300":"bg-violet-100 text-gray-800 transition-all duration-300"}`,children:a.data},t))}),e.jsxs("div",{className:"mt-[2rem]",children:["* Calculate from ",q.toJSON().slice(0,10)," Last ",Je," Data"]}),e.jsx(N,{className:"mt-[2rem]",children:e.jsx(X,{variant:"contained",onClick:()=>{Ze(Je,Nt,q.toJSON().slice(0,10),o==null?void 0:o.TIME)},children:Gt?"Process.....":"Calculate"})})]})]}),e.jsxs(st,{value:"2",children:[e.jsxs(f,{children:[e.jsx("i",{className:"fa-solid fa-file-pen"})," Input Manual (",g.partNo,")"]}),c==null?void 0:c.map((a,t)=>e.jsxs("div",{children:[e.jsxs(f,{fontSize:12,children:[e.jsx("i",{className:"fa-solid fa-arrow-right mr-2 text-[red]"}),"Point No.",a.POINT_NO]}),e.jsxs(f,{fontSize:12,children:["SPEC : ",a==null?void 0:a.LSL," - ",a==null?void 0:a.USL," mm"]})]},t)),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 mt-1",children:h==null?void 0:h.map((a,t)=>{var r,L;return e.jsxs(N,{className:"flex justify-center flex-col items-start border-[1px] p-2",children:[e.jsxs(Ye,{color:"primary",className:"my-1",children:["Point No. ",t+1]}),e.jsx("div",{className:"mb-[1rem]",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{fontSize:12,children:"LCL :"}),e.jsx(H,{size:"small",placeholder:"LCL",value:(r=I[t])==null?void 0:r.LCL_MANUAL,className:"w-[120px]",onChange:i=>Ft(i.target.value,t,"lcl")})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{fontSize:12,children:"UCL :"}),e.jsx(H,{size:"small",placeholder:"UCL",value:(L=I[t])==null?void 0:L.UCL_MANUAL,className:"w-[120px]",onChange:i=>Ft(i.target.value,t,"ucl")})]})})]})})}),e.jsx(N,{className:"mt-[1rem]",children:e.jsx(X,{variant:"contained",onClick:ia,children:"OK"})})]})]})})}),e.jsx(qe,{open:Wt,onClose:()=>Ct(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(N,{sx:{...nt,height:"90%",width:"80%",overflow:"hidden",overflowY:"auto"},children:e.jsx("img",{src:`${y}/backend_qc_inspection/uploads/drawing/${x}`,alt:x,width:"100%",height:"auto"})})}),e.jsx(qe,{open:qt,onClose:()=>et(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(N,{sx:{...nt,height:"90%",width:"60%",overflow:"hidden",overflowY:"auto"},children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs(f,{fontWeight:"bold",children:["PSTH Part No : ",g.partNo]}),e.jsx(Ye,{color:((wt=d[0])==null?void 0:wt.JUST_ON)==="X,Y"&&"info"||"primary",children:(At=d[0])==null?void 0:At.JUST_ON})]}),e.jsxs(f,{fontSize:12,fontWeight:"bold",children:["Customer Name : ",(Pt=d[0])==null?void 0:Pt.CUSTOMER_NAME]}),c==null?void 0:c.map((a,t)=>e.jsxs("div",{children:[e.jsxs(f,{fontSize:12,children:[e.jsx("i",{className:"fa-solid fa-arrow-right mr-2 text-[red]"}),"Point No.",a.POINT_NO]}),e.jsxs(f,{fontSize:12,children:["SPEC : ",a==null?void 0:a.LSL," - ",a==null?void 0:a.USL," mm"]})]},t))]}),e.jsx("hr",{}),e.jsxs(N,{className:"flex gap-x-2 my-[1rem]",children:[e.jsx(X,{variant:"contained",onClick:da,children:"Confirm"}),e.jsx(X,{variant:"contained",color:"error",onClick:()=>et(!1),children:"Close"})]}),e.jsxs("div",{className:"flex ml-[8rem] gap-x-3 mt-3",children:[e.jsxs("div",{className:"flex flex-col justify-center text-center",children:[e.jsx("p",{children:"Sample 1"}),e.jsx(H,{placeholder:"Cavity No.",size:"small",sx:{width:90},value:J,disabled:!0})]}),e.jsxs("div",{className:"flex flex-col justify-center text-center",children:[e.jsx("p",{children:"Sample 2"}),e.jsx(H,{placeholder:"Cavity No.",size:"small",sx:{width:90},value:B,disabled:!0})]})]}),e.jsxs(N,{className:"flex gap-x-5",children:[e.jsx(N,{children:Array.from({length:n.length}).map((a,t)=>{var T,Z,se,le,oe;const r=(T=n[t].valueCheck)==null?void 0:T.map(U=>parseFloat(U.value).toFixed(2)),s=r.map(U=>parseFloat(U)).reduce((U,m)=>U+m,0)/r.length;return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("p",{className:"font-bold text-[14px]",children:["Point No. ",t+1," "]})}),Array.isArray(n[t].valueCheck)?e.jsxs("div",{children:[n[t].valueCheck.map((U,m)=>{var M,b,re,ne,ce,ie,de,ue,pe,me,he,xe,fe,Ne,ge,Ce,Se,Le,je,ye,ve,_e,Oe,Fe,be,Te,Ue,ke,we,Ae,Pe,Ie;return e.jsx("div",{children:e.jsx("table",{children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"mr-2",children:U.name_result})}),e.jsx("td",{children:e.jsx("p",{children:e.jsx(H,{size:"small",style:{width:90},value:n[t].valueCheck[m].value||"",sx:parseFloat((M=h[t])==null?void 0:M.UCL)<parseFloat((re=(b=n[t])==null?void 0:b.valueCheck[m])==null?void 0:re.value)&&((ne=d[0])==null?void 0:ne.JUST_ON)==="X,Y"||parseFloat((ce=h[t])==null?void 0:ce.LCL)>parseFloat((de=(ie=n[t])==null?void 0:ie.valueCheck[m])==null?void 0:de.value)&&((ue=d[0])==null?void 0:ue.JUST_ON)==="X,Y"||parseFloat((pe=c[t])==null?void 0:pe.USL)<parseFloat((he=(me=n[t])==null?void 0:me.valueCheck[m])==null?void 0:he.value)&&((xe=d[0])==null?void 0:xe.JUST_ON)==="X,Y"||parseFloat((fe=c[t])==null?void 0:fe.LSL)>parseFloat((ge=(Ne=n[t])==null?void 0:Ne.valueCheck[m])==null?void 0:ge.value)&&((Ce=d[0])==null?void 0:Ce.JUST_ON)==="X,Y"?{background:"red",color:"#fff",borderRadius:"8px",input:{color:"white"}}:{color:"black"},error:parseFloat((Se=h[t])==null?void 0:Se.UCL)<parseFloat((je=(Le=n[t])==null?void 0:Le.valueCheck[m])==null?void 0:je.value)&&((ye=d[0])==null?void 0:ye.JUST_ON)==="X,Y"||parseFloat((ve=h[t])==null?void 0:ve.LCL)>parseFloat((Oe=(_e=n[t])==null?void 0:_e.valueCheck[m])==null?void 0:Oe.value)&&((Fe=d[0])==null?void 0:Fe.JUST_ON)==="X,Y"||parseFloat((be=c[t])==null?void 0:be.USL)<parseFloat((Ue=(Te=n[t])==null?void 0:Te.valueCheck[m])==null?void 0:Ue.value)&&((ke=d[0])==null?void 0:ke.JUST_ON)==="X,Y"||parseFloat((we=c[t])==null?void 0:we.LSL)>parseFloat((Pe=(Ae=n[t])==null?void 0:Ae.valueCheck[m])==null?void 0:Pe.value)&&((Ie=d[0])==null?void 0:Ie.JUST_ON)==="X,Y"})})})]})})})},m)}),e.jsxs("div",{className:"flex items-center mt-[1rem]",children:[e.jsx(f,{children:"Average ="}),e.jsx(N,{className:s.toFixed(2)>((Z=h[t])==null?void 0:Z.UCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((se=h[t])==null?void 0:se.LCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)>((le=c[t])==null?void 0:le.USL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((oe=c[t])==null?void 0:oe.LSL)&&!Number.isNaN(parseFloat(s.toFixed(2)))?"ml-[4rem] p-2 rounded-md bg-[red] flex justify-center text-[white]":"ml-[4rem] p-2 rounded-md bg-slate-100 flex justify-center text-[#313131]",width:80,children:e.jsx(f,{fontSize:14,children:Number.isNaN(parseFloat(s.toFixed(2)))?"Wait..":s.toFixed(2)})})]})]}):e.jsx("p",{children:"Not an array"}),e.jsx("div",{className:"mb-[1rem] mt-[1rem]",children:e.jsx("hr",{})})]},t)})}),e.jsx(N,{children:Array.from({length:p.length}).map((a,t)=>{var T,Z,se,le,oe;const r=(T=p[t].valueCheck)==null?void 0:T.map(U=>parseFloat(U.value2).toFixed(2)),s=r.map(U=>parseFloat(U)).reduce((U,m)=>U+m,0)/r.length;return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("p",{className:"font-bold text-[14px]",children:"-"})}),Array.isArray(p[t].valueCheck)?p[t].valueCheck.map((U,m)=>{var M,b,re,ne,ce,ie,de,ue,pe,me,he,xe,fe,Ne,ge,Ce,Se,Le,je,ye,ve,_e,Oe,Fe,be,Te,Ue,ke,we,Ae,Pe,Ie;return e.jsx("div",{children:e.jsx("table",{children:e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{children:e.jsx("p",{children:e.jsx(H,{size:"small",value:p[t].valueCheck[m].value2||"",sx:parseFloat((M=h[t])==null?void 0:M.UCL)<parseFloat((re=(b=p[t])==null?void 0:b.valueCheck[m])==null?void 0:re.value2)&&((ne=d[0])==null?void 0:ne.JUST_ON)==="X,Y"||parseFloat((ce=h[t])==null?void 0:ce.LCL)>parseFloat((de=(ie=p[t])==null?void 0:ie.valueCheck[m])==null?void 0:de.value2)&&((ue=d[0])==null?void 0:ue.JUST_ON)==="X,Y"||parseFloat((pe=c[t])==null?void 0:pe.USL)<parseFloat((he=(me=p[t])==null?void 0:me.valueCheck[m])==null?void 0:he.value2)&&((xe=d[0])==null?void 0:xe.JUST_ON)==="X,Y"||parseFloat((fe=c[t])==null?void 0:fe.LSL)>parseFloat((ge=(Ne=p[t])==null?void 0:Ne.valueCheck[m])==null?void 0:ge.value2)&&((Ce=d[0])==null?void 0:Ce.JUST_ON)==="X,Y"?{width:90,background:"red",color:"#fff",borderRadius:"8px",input:{color:"white"}}:{width:90,color:"black"},error:parseFloat((Se=h[t])==null?void 0:Se.UCL)<parseFloat((je=(Le=p[t])==null?void 0:Le.valueCheck[m])==null?void 0:je.value2)&&((ye=d[0])==null?void 0:ye.JUST_ON)==="X,Y"||parseFloat((ve=h[t])==null?void 0:ve.LCL)>parseFloat((Oe=(_e=p[t])==null?void 0:_e.valueCheck[m])==null?void 0:Oe.value2)&&((Fe=d[0])==null?void 0:Fe.JUST_ON)==="X,Y"||parseFloat((be=c[t])==null?void 0:be.USL)<parseFloat((Ue=(Te=p[t])==null?void 0:Te.valueCheck[m])==null?void 0:Ue.value2)&&((ke=d[0])==null?void 0:ke.JUST_ON)==="X,Y"||parseFloat((we=c[t])==null?void 0:we.LSL)>parseFloat((Pe=(Ae=p[t])==null?void 0:Ae.valueCheck[m])==null?void 0:Pe.value2)&&((Ie=d[0])==null?void 0:Ie.JUST_ON)==="X,Y"})})})})})})},m)}):e.jsx("p",{children:"Not an array"}),e.jsx(N,{className:s.toFixed(2)>((Z=h[t])==null?void 0:Z.UCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((se=h[t])==null?void 0:se.LCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)>((le=c[t])==null?void 0:le.USL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((oe=c[t])==null?void 0:oe.LSL)&&!Number.isNaN(parseFloat(s.toFixed(2)))?"mt-[1rem] ml-2 p-2 rounded-md bg-[red] flex justify-center text-[white]":"mt-[1rem] ml-2 p-2 rounded-md bg-slate-100 flex justify-center text-[#313131]",width:80,children:e.jsx(f,{fontSize:14,children:Number.isNaN(parseFloat(s.toFixed(2)))?"Wait..":s.toFixed(2)})}),e.jsx("div",{className:"mb-[1rem] mt-[1rem]",children:e.jsx("hr",{})})]},t)})})]})]})}),e.jsxs(dt,{container:!0,children:[e.jsxs(dt,{item:!0,xs:12,lg:7,children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs(f,{fontWeight:"bold",children:["PSTH Part No : ",g.partNo]}),e.jsx(Ye,{color:((It=d[0])==null?void 0:It.JUST_ON)==="X,Y"&&"info"||"primary",children:(Rt=d[0])==null?void 0:Rt.JUST_ON})]}),e.jsxs(f,{fontSize:12,fontWeight:"bold",children:["Customer Name : ",(Mt=d[0])==null?void 0:Mt.CUSTOMER_NAME]}),c==null?void 0:c.map((a,t)=>e.jsxs("div",{children:[e.jsxs(f,{fontSize:12,children:[e.jsx("i",{className:"fa-solid fa-arrow-right mr-2 text-[red]"}),"Point No.",a.POINT_NO]}),e.jsxs(f,{fontSize:12,children:["SPEC : ",a==null?void 0:a.LSL," - ",a==null?void 0:a.USL," mm"]})]},t))]}),e.jsx(N,{className:"mt-[1rem] mb-1",children:e.jsxs(La,{className:"w-[200px]",children:[e.jsx(ja,{id:"demo-simple-select-label",children:"Mold No."}),e.jsx(ya,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:Nt,label:"Mold No",size:"small",onChange:a=>{it(a.target.value,o==null?void 0:o.DATE,o==null?void 0:o.TIME),Ze(Je,a.target.value,o==null?void 0:o.DATE,o==null?void 0:o.TIME),gt(a.target.value)},children:lt==null?void 0:lt.map((a,t)=>e.jsx(pa,{value:a.MOLD_NO,children:a.MOLD_NO},t))})]})}),e.jsx(N,{className:"flex items-center gap-x-2 mb-2",children:e.jsx(X,{variant:"contained",size:"small",sx:{marginTop:1},onClick:ea,children:"คำนวณ UCL - LCL"})}),e.jsx(N,{children:c.map((a,t)=>{var r,L,i,s;return e.jsxs(e.Fragment,{children:[e.jsxs(Ye,{color:"primary",children:["Point No. ",t+1]},t),ca?e.jsx("div",{children:e.jsxs(f,{fontSize:12,marginTop:1,children:["Manual Input UCL = ",(i=I[t])==null?void 0:i.UCL_MANUAL," mm , LCL ="," ",(s=I[t])==null?void 0:s.LCL_MANUAL," mm"]})}):e.jsxs("div",{children:[e.jsxs(f,{fontSize:12,marginTop:1,children:["Calculated from ",Je," Data dating back to"," ",q.toJSON().slice(0,10)," ",o==null?void 0:o.TIME," :"]}),e.jsxs(f,{fontSize:12,marginTop:1,children:["UCL = ",(r=h[t])==null?void 0:r.UCL," mm , LCL = ",(L=h[t])==null?void 0:L.LCL," mm"]})]}),e.jsxs(f,{fontSize:12,marginTop:1,children:["X Bar Chart - ",t+1]}),e.jsx(ga,{isLoad:!1,lslValue:parseFloat(a==null?void 0:a.LSL),uslValue:parseFloat(a==null?void 0:a.USL),dataValue:S,point:parseInt(t,10)+1,controlData:h,uclControl:v,lclControl:O},t),e.jsxs(f,{fontSize:12,marginTop:1,children:["R Bar Chart - ",t+1]}),e.jsx(Ca,{isLoad:!1,lslValue:parseFloat(a==null?void 0:a.LSL),uslValue:parseFloat(a==null?void 0:a.USL),dataValue:S,point:parseInt(t,10)+1,controlData:h,uclControl:v,lclControl:O},t)]})})}),e.jsx(N,{})]}),e.jsx(dt,{item:!0,xs:12,lg:5,children:e.jsxs(N,{fontSize:12,marginTop:3,children:[e.jsxs(N,{className:"flex items-center mb-[1rem]",children:[e.jsx(f,{fontSize:12,fontWeight:"bold",marginRight:2,children:"Lot No. :"}),e.jsx(H,{disabled:!0,value:G,sx:{marginLeft:1},size:"small",placeholder:"Lot No.",id:"outlined-basic",label:"Lot No",variant:"outlined",inputRef:tt})]}),e.jsxs(N,{className:"flex items-center mb-[1rem]",children:[e.jsx(f,{fontSize:12,fontWeight:"bold",marginRight:2,children:"Mold No. :"}),e.jsx(H,{size:"small",placeholder:"Mold No.",id:"outlined-basic",label:"Mold No",variant:"outlined",inputRef:Kt,disabled:!0,value:W})]}),e.jsxs(N,{className:"flex items-center mb-[0.2rem]",children:[e.jsx(f,{fontSize:12,fontWeight:"bold",marginRight:4,children:"ผู้ตรวจ :"}),e.jsx(H,{size:"small",placeholder:"ระบุชื่อย่อ เช่น AWK",id:"outlined-basic",label:"Inspector",variant:"outlined",inputRef:Zt,value:te,disabled:!0,onChange:a=>{const t=/^[a-zA-Z0-9]*$/,r=a.target.value.replace(/[^a-zA-Z]/g,"");t.test(r)?De(r.slice(0,4)):console.log("Only English characters are allowed.")},onKeyPress:a=>{a.key==="Enter"&&a.target.value!==""&&rt.current[0].focus()}})]}),e.jsx("span",{className:"text-[red] text-[12px] ml-[5rem]",children:"* ระบุชื่อย่อ เช่น AWK"}),e.jsxs(N,{className:"mt-[1rem]",children:[V===""?e.jsxs(f,{fontSize:12,fontWeight:"bold",marginRight:2,component:"span",children:["Time : ",e.jsx("span",{className:"text-[red]",children:"ไม่ได้เลือกเวลา"})]}):e.jsxs(f,{fontSize:12,fontWeight:"bold",marginRight:2,component:"span",children:["Time : ",o.DATE," ",V," น."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 p-2",children:ut==null?void 0:ut.map((a,t)=>e.jsx("button",{type:"button",ref:r=>{rt.current[t]=r},onClick:()=>{Ee(o.TIME),ae.current[0][0].focus()},className:`p-[5px] flex justify-center rounded-[5px] ${a.time===V?"bg-violet-400 text-white transition-all duration-300":"bg-violet-100 text-gray-800 transition-all duration-300"}`,children:a.time},t))}),e.jsx("div",{className:"mb-2",children:e.jsxs(f,{fontSize:12,fontWeight:"bold",marginRight:2,component:"span",children:["Drawing :"," ",e.jsx(X,{variant:"outlined",size:"small",onClick:()=>{F(c[0].FILENAME),Ct(!0)},children:"Drawing"})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs(f,{fontSize:12,fontWeight:"bold",marginRight:2,component:"span",children:["Control Chart :"," ",e.jsx(X,{variant:"outlined",size:"small",onClick:()=>{j(!0)},children:"Control Chart"})]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex ml-[5.5rem] gap-x-2 mt-3",children:[e.jsxs("div",{className:"flex flex-col justify-center text-center",children:[e.jsx("p",{children:"Sample 1"}),e.jsx(H,{placeholder:"Cavity No.",size:"small",sx:{width:80},value:J,inputRef:ot,onKeyPress:a=>{a.key==="Enter"&&ae.current[0][0].focus()},disabled:G===""||W===""||V==="",onChange:ta})]}),e.jsxs("div",{className:"flex flex-col justify-center text-center",children:[e.jsx("p",{children:"Sample 2"}),e.jsx(H,{placeholder:"Cavity No.",size:"small",sx:{width:80},inputRef:St,value:B,onChange:aa,onKeyPress:a=>{a.key==="Enter"&&Xe.current[0][0].focus()},disabled:G===""||W===""||V===""})]})]}),e.jsxs(N,{className:"flex gap-x-5",children:[e.jsx(N,{children:Array.from({length:n.length}).map((a,t)=>{var T,Z,se,le,oe,U,m;const r=(T=n[t].valueCheck)==null?void 0:T.map(M=>parseFloat(M.value).toFixed(2)),s=r.map(M=>parseFloat(M)).reduce((M,b)=>M+b,0)/r.length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center my-1 gap-x-1",children:[e.jsxs("p",{className:"font-bold text-[14px]",children:["Point No. ",t+1," "]}),(Z=h[t])==null?void 0:Z.LCL," - ",(se=h[t])==null?void 0:se.UCL," mm"]}),Array.isArray(n[t].valueCheck)?e.jsxs("div",{children:[n[t].valueCheck.map((M,b)=>{var re,ne,ce,ie,de,ue,pe,me,he,xe,fe,Ne,ge,Ce,Se,Le,je,ye,ve,_e,Oe,Fe,be,Te,Ue,ke,we,Ae,Pe,Ie,Be,Et;return e.jsx("div",{children:e.jsx("table",{children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"mr-2",children:M.name_result})}),e.jsx("td",{children:e.jsx("p",{children:e.jsx(H,{onChange:We=>{_t(We.target.value,t,b)},onKeyPress:We=>sa(We,t,b),onFocus:()=>{_t("",t,b)},size:"small",inputRef:We=>{ae.current[t]||(ae.current[t]=[]),We&&(ae.current[t][b]=We)},style:{width:90},value:n[t].valueCheck[b].value||"",sx:parseFloat((re=h[t])==null?void 0:re.UCL)<parseFloat((ce=(ne=n[t])==null?void 0:ne.valueCheck[b])==null?void 0:ce.value)&&((ie=d[0])==null?void 0:ie.JUST_ON)==="X,Y"||parseFloat((de=h[t])==null?void 0:de.LCL)>parseFloat((pe=(ue=n[t])==null?void 0:ue.valueCheck[b])==null?void 0:pe.value)&&((me=d[0])==null?void 0:me.JUST_ON)==="X,Y"||parseFloat((he=c[t])==null?void 0:he.USL)<parseFloat((fe=(xe=n[t])==null?void 0:xe.valueCheck[b])==null?void 0:fe.value)&&((Ne=d[0])==null?void 0:Ne.JUST_ON)==="X,Y"||parseFloat((ge=c[t])==null?void 0:ge.LSL)>parseFloat((Se=(Ce=n[t])==null?void 0:Ce.valueCheck[b])==null?void 0:Se.value)&&((Le=d[0])==null?void 0:Le.JUST_ON)==="X,Y"?{background:"red",color:"#fff",borderRadius:"8px",input:{color:"white"}}:{color:"black"},error:parseFloat((je=h[t])==null?void 0:je.UCL)<parseFloat((ve=(ye=n[t])==null?void 0:ye.valueCheck[b])==null?void 0:ve.value)&&((_e=d[0])==null?void 0:_e.JUST_ON)==="X,Y"||parseFloat((Oe=h[t])==null?void 0:Oe.LCL)>parseFloat((be=(Fe=n[t])==null?void 0:Fe.valueCheck[b])==null?void 0:be.value)&&((Te=d[0])==null?void 0:Te.JUST_ON)==="X,Y"||parseFloat((Ue=c[t])==null?void 0:Ue.USL)<parseFloat((we=(ke=n[t])==null?void 0:ke.valueCheck[b])==null?void 0:we.value)&&((Ae=d[0])==null?void 0:Ae.JUST_ON)==="X,Y"||parseFloat((Pe=c[t])==null?void 0:Pe.LSL)>parseFloat((Be=(Ie=n[t])==null?void 0:Ie.valueCheck[b])==null?void 0:Be.value)&&((Et=d[0])==null?void 0:Et.JUST_ON)==="X,Y"})})})]})})})},b)}),e.jsxs("div",{className:"flex items-center mt-[1rem]",children:[e.jsx(f,{children:"Average = "}),e.jsx(N,{className:s.toFixed(2)>((le=h[t])==null?void 0:le.UCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((oe=h[t])==null?void 0:oe.LCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)>((U=c[t])==null?void 0:U.USL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((m=c[t])==null?void 0:m.LSL)&&!Number.isNaN(parseFloat(s.toFixed(2)))?"ml-[1.5rem] p-2 rounded-md bg-[red] flex justify-center text-[white]":"ml-[1.5rem] p-2 rounded-md bg-slate-100 flex justify-center text-[#313131]",width:80,children:e.jsx(f,{fontSize:14,children:Number.isNaN(parseFloat(s.toFixed(2)))?"Wait..":s.toFixed(2)})})]})]}):e.jsx("p",{children:"Not an array"}),e.jsx("div",{className:"mb-[1rem] mt-[1rem]",children:e.jsx("hr",{})})]},t)})}),e.jsx(N,{children:Array.from({length:p.length}).map((a,t)=>{var T,Z,se,le,oe;const r=(T=p[t].valueCheck)==null?void 0:T.map(U=>parseFloat(U.value2).toFixed(2)),s=r.map(U=>parseFloat(U)).reduce((U,m)=>U+m,0)/r.length;return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center my-1",children:e.jsx("p",{className:"font-bold text-[14px]",children:"-"})}),Array.isArray(p[t].valueCheck)?p[t].valueCheck.map((U,m)=>{var M,b,re,ne,ce,ie,de,ue,pe,me,he,xe,fe,Ne,ge,Ce,Se,Le,je,ye,ve,_e,Oe,Fe,be,Te,Ue,ke,we,Ae,Pe,Ie;return e.jsx("div",{children:e.jsx("table",{children:e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{children:e.jsx("p",{children:e.jsx(H,{size:"small",onChange:Be=>{Ot(Be.target.value,t,m)},onFocus:()=>{Ot("",t,m)},onKeyPress:Be=>la(Be,t,m),inputRef:Be=>{Xe.current[t]||(Xe.current[t]=[]),Be&&(Xe.current[t][m]=Be)},value:p[t].valueCheck[m].value2||"",sx:parseFloat((M=h[t])==null?void 0:M.UCL)<parseFloat((re=(b=p[t])==null?void 0:b.valueCheck[m])==null?void 0:re.value2)&&((ne=d[0])==null?void 0:ne.JUST_ON)==="X,Y"||parseFloat((ce=h[t])==null?void 0:ce.LCL)>parseFloat((de=(ie=p[t])==null?void 0:ie.valueCheck[m])==null?void 0:de.value2)&&((ue=d[0])==null?void 0:ue.JUST_ON)==="X,Y"||parseFloat((pe=c[t])==null?void 0:pe.USL)<parseFloat((he=(me=p[t])==null?void 0:me.valueCheck[m])==null?void 0:he.value2)&&((xe=d[0])==null?void 0:xe.JUST_ON)==="X,Y"||parseFloat((fe=c[t])==null?void 0:fe.LSL)>parseFloat((ge=(Ne=p[t])==null?void 0:Ne.valueCheck[m])==null?void 0:ge.value2)&&((Ce=d[0])==null?void 0:Ce.JUST_ON)==="X,Y"?{width:90,background:"red",color:"#fff",borderRadius:"8px",input:{color:"white"}}:{width:90,color:"black"},error:parseFloat((Se=h[t])==null?void 0:Se.UCL)<parseFloat((je=(Le=p[t])==null?void 0:Le.valueCheck[m])==null?void 0:je.value2)&&((ye=d[0])==null?void 0:ye.JUST_ON)==="X,Y"||parseFloat((ve=h[t])==null?void 0:ve.LCL)>parseFloat((Oe=(_e=p[t])==null?void 0:_e.valueCheck[m])==null?void 0:Oe.value2)&&((Fe=d[0])==null?void 0:Fe.JUST_ON)==="X,Y"||parseFloat((be=c[t])==null?void 0:be.USL)<parseFloat((Ue=(Te=p[t])==null?void 0:Te.valueCheck[m])==null?void 0:Ue.value2)&&((ke=d[0])==null?void 0:ke.JUST_ON)==="X,Y"||parseFloat((we=c[t])==null?void 0:we.LSL)>parseFloat((Pe=(Ae=p[t])==null?void 0:Ae.valueCheck[m])==null?void 0:Pe.value2)&&((Ie=d[0])==null?void 0:Ie.JUST_ON)==="X,Y"})})})})})})},m)}):e.jsx("p",{children:"Not an array"}),e.jsx(N,{className:s.toFixed(2)>((Z=h[t])==null?void 0:Z.UCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((se=h[t])==null?void 0:se.LCL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)>((le=c[t])==null?void 0:le.USL)&&!Number.isNaN(parseFloat(s.toFixed(2)))||s.toFixed(2)<((oe=c[t])==null?void 0:oe.LSL)&&!Number.isNaN(parseFloat(s.toFixed(2)))?"mt-[1rem] ml-2 p-2 rounded-md bg-[red] flex justify-center text-[white]":"mt-[1rem] ml-2 p-2 rounded-md bg-slate-100 flex justify-center text-[#313131]",width:80,children:e.jsx(f,{fontSize:14,children:Number.isNaN(parseFloat(s.toFixed(2)))?"Wait..":s.toFixed(2)})}),e.jsx("div",{className:"mb-[1rem] mt-[1rem]",children:e.jsx("hr",{})})]},t)})})]}),e.jsx(N,{children:e.jsx(X,{variant:"contained",onClick:ua,ref:Lt,children:"Update"})})]})})]})]})},Fa=Yt;Yt.propTypes={psthPartNo:Q.object,obj:Q.object,handleCloseModal:Q.func,oldCavityList:Q.array};const ba=Xt({typography:{fontFamily:"Prompt, sans-serif"},components:{MuiPaper:{styleOverrides:{root:{boxShadow:"none",borderRadius:"15px"}}},MuiTable:{styleOverrides:{root:{boxShadow:"none"}}},MuiTableCell:{styleOverrides:{root:{padding:"10px",textAlign:"center"}}}}});function Ta(){const[g,o]=l.useState([]),[Re,E]=l.useState(!1),[y,d]=l.useState(!1),[w,c]=l.useState({}),[Me,h]=l.useState({}),[K,n]=l.useState([]),[$,p]=l.useState([]),[R,J]=l.useState({}),[ee,B]=l.useState(!1),[Y,G]=l.useState([]),[Ve,W]=l.useState([]),D="http://backend-qcinspection";console.log(w);const V=C=>{const x=g.find(F=>F.NO===C);h(x)},Ee=()=>{B(!1)},te=()=>{B(!0)},De=l.useCallback(async()=>{await z.post(`${D}/backend_qc_inspection/api`,{router:"getInspectionNG"}).then(C=>{E(!0),C.data.err&&C.data.msg!=="Not Found!"?console.log(C.data.msg):!C.data.err&&C.data.status==="Ok"?(o(C.data.result),console.log("History",C.data.result),E(!1)):C.data.err&&C.data.msg==="Not Found!"?(E(!1),o([])):o([])}).catch(C=>{console.log(C)})},[D]);console.log(g);const $e=l.useCallback(C=>{const x={};return C.forEach(F=>{x[F.POINT_NO]||(x[F.POINT_NO]=[]),x[F.POINT_NO].push(F)}),Object.values(x).sort((F,P)=>F[0].point-P[0].point)},[]),He=async(C,x,F,P)=>{await z.post(`${D}/backend_qc_inspection/api`,{router:"getInspectionPartByDatetime",psthPartNo:C,date:x,time:F,mold:P}).then(j=>{if(j.data.err)console.log(j.data.msg);else if(!j.data.err&&j.data.status==="Ok"){n(j.data.result);const k=$e(j.data.result);p(k),setTimeout(()=>{te()},300)}}).catch(j=>{console.log(j)})},[S,u]=l.useState([]),v=async(C,x,F,P)=>{await z.post(`${D}/backend_qc_inspection/api`,{router:"getListCavity",psthPartNo:C,date:x,time:F,mold:P}).then(j=>{j.data.err?console.log(j.data.msg):!j.data.err&&j.data.status==="Ok"&&(u(j.data.result),setTimeout(()=>{console.log(Me),d(!0)},200))}).catch(j=>{console.log(j)})},A=async C=>{await z.post(`${D}/backend_qc_inspection/api`,{router:"getStandardByPart",bsthPartNo:C}).then(x=>{x.data.err?console.log(x.data.msg):!x.data.err&&x.data.status==="Ok"&&W(x.data.result)}).catch(x=>{console.log(x)})};console.log("inspectionNg",K),console.log("inspectionNgByPoint",$);const O=[{name:"NO",label:"Row #"},{name:"BSNCR_PART_NO",label:"PSTH Part No"},{name:"LOT_NO",label:"LOT_NO"},{name:"DATE",label:"Date"},{name:"MOLD_NO",label:"MOLD_NO"},{name:"TIME",label:"Time",options:{customBodyRender:(C,x)=>e.jsx(Ye,{color:"primary",children:x.rowData[5]})}},{name:"NG",label:"Result",options:{customBodyRender:(C,x)=>e.jsx(Ye,{color:parseInt(x.rowData[6],10)>0&&"error"||"success",children:parseInt(x.rowData[6],10)>0?"NG":"FG"})}},{name:"INSPECTOR",label:"Inspector"},{name:"action",label:"Action",options:{customBodyRender:(C,x)=>x.rowData[9]==="Y"&&x.rowData[10]?e.jsxs(X,{type:"button",style:{cursor:"pointer"},size:"small",variant:"outlined",onClick:()=>{const F=x.rowData[1],P=x.rowData[3],j=x.rowData[4],k=x.rowData[5];c({partNo:x.rowData[1]}),V(x.rowData[0]),v(F,P,k,j)},children:[e.jsx("i",{className:"fa-solid fa-arrows-rotate mr-2"})," Re check"]}):e.jsxs(X,{type:"button",style:{cursor:"pointer"},size:"small",variant:"outlined",onClick:()=>{const F=x.rowData[1],P=x.rowData[3],j=x.rowData[4],k=x.rowData[5];J({psthPartNo:F,dateProps:P,moldProps:j,timeProps:k}),He(F,P,k,j),A(F),I(100,j,P,F,k)},children:[e.jsx("i",{className:"fa-regular fa-eye mr-2"})," View"]})}},{name:"APPROVE",label:"APPROVE",options:{display:!1}},{name:"WAIT_REINSPECTION",label:"WAIT_REINSPECTION",options:{display:!1}}],_={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",borderRadius:"4px",boxShadow:"rgba(158, 199, 243, 0.65) 0 0 15px 2px",pt:2,px:4,pb:3},q=()=>{d(!1)},Ge=mt(C=>C.isChange),I=l.useCallback(async(C,x,F,P,j)=>{await z.post(`${D}/backend_qc_inspection/api`,{router:"getXBarUCL",psthPartNo:P,n:2,dateInspection:`${F} ${j}:00`,MoldNo:x,top:C}).then(k=>{k.data.err&&k.data.msg!=="Not Found!"?G([]):!k.data.err&&k.data.status==="Ok"?G(k.data.result):k.data.err&&k.data.msg==="Not Found!"&&ze.fire({icon:"warning",title:"Not Found!",text:"ไม่พบ Data ที่จะคำนวณ UCL LCL"})}).catch(k=>{console.log(k)})},[D]);return l.useEffect(()=>{De()},[De,Ge]),e.jsxs("div",{children:[e.jsx(ht,{inspectionNg:K,inspectionNgByPoint:$,objHistory:R,isOpen:ee,handleClose:Ee,style:_,standard:Ve,controlData:Y}),e.jsx(f,{variant:"h4",children:"History"}),e.jsx(qe,{open:y,onClose:q,children:e.jsx(pt,{in:y,timeout:300,children:e.jsxs(N,{sx:{..._},width:"100%",height:"100%",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h4",{className:"font-bold",children:[e.jsx("i",{className:"fa-solid fa-arrows-rotate mr-2"}),"Re Check Data"]}),e.jsxs(X,{variant:"outlined",color:"error",onClick:()=>{d(!1)},children:[e.jsx("i",{className:"fa-solid fa-xmark mr-1"}),"Close"]})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsx(Fa,{psthPartNo:w,obj:Me,handleCloseModal:q,oldCavityList:S})})]})})}),Re?e.jsx("p",{children:"Loading ..."}):e.jsx(Dt,{theme:ba,children:e.jsx(zt,{options:Bt,columns:O,data:g})})]})}function Ua(){const g=ma(),o=ha();console.log("param",g.tab);function Re(y){return/^[0-9]*$/.test(y)}const E=(y,d)=>{o(`/history/${d}`)};return l.useEffect(()=>{parseInt(g.tab,10)>2?o("/history/1"):Re(parseInt(g.tab,10))||o("/history/1")},[o,g.tab]),e.jsx("div",{children:e.jsx(N,{sx:{width:"100%",typography:"body1"},children:e.jsxs($t,{value:g.tab,children:[e.jsx(N,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Jt,{onChange:E,"aria-label":"lab API tabs example",children:[e.jsx(at,{label:"Inspection FG",value:"1"}),e.jsx(at,{label:"Inspection NG",value:"2"})]})}),e.jsx(st,{value:"1",children:e.jsx(_a,{})}),e.jsx(st,{value:"2",children:e.jsx(Ta,{})})]})})})}function za(){return e.jsxs(e.Fragment,{children:[e.jsx(fa,{}),e.jsx(xa,{children:e.jsx("title",{children:" History | QC Inspection System "})}),e.jsx(Ua,{})]})}export{za as default};
